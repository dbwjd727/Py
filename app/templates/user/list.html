<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    {% include 'navigator/menu.html' %}

    <div class="content">
        <h1>회원 목록</h1>
        <table>
            <thead>
                <tr>
                    <th>이름</th>
                    <th>이메일</th>
                    <th> </th>
                    <th> </th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td>
                        <button onclick="openEditModal('{{ user.id }}', '{{ user.name }}', '{{ user.email }}')">수정</button>
                    </td>
                    <td>
                        <button onclick="deleteUser('{{ user.id }}')">삭제</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>

    <!-- 수정 모달 -->
    <div id="editModal" style="display: none;">
        <div>
            <h2>사용자 수정</h2>
            <form id="editForm">
                <input type="hidden" id="editUserId">
                <label for="editUserName">이름:</label>
                <input type="text" id="editUserName" name="name"><br><br>
                <label for="editUserEmail">이메일:</label>
                <input type="email" id="editUserEmail" name="email"><br><br>
                <button type="button" onclick="submitEdit()">수정 완료</button>
                <button type="button" onclick="closeEditModal()">취소</button>
            </form>
        </div>
    </div>

    <script>
        function openEditModal(userId, userName, userEmail) {
            document.getElementById('editUserId').value = userId;
            document.getElementById('editUserName').value = userName;
            document.getElementById('editUserEmail').value = userEmail;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function submitEdit() {
            var userId = document.getElementById('editUserId').value;
            var userName = document.getElementById('editUserName').value;
            var userEmail = document.getElementById('editUserEmail').value;

            // 수정 요청을 서버로 전송
            fetch(`/user/update/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: userName, email: userEmail })
            }).then(response => {
                if (response.ok) {
                    alert('사용자 정보가 수정되었습니다.');
                    window.location.reload();
                } else {
                    alert('수정 실패');
                }
            });

            closeEditModal();
        }

        function deleteUser(userId) {
            if (confirm('정말로 삭제하시겠습니까?')) {
                fetch(`/user/delete/${userId}`, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.ok) {
                        alert('사용자가 삭제되었습니다.');
                        window.location.reload();
                    } else {
                        alert('삭제 실패');
                    }
                });
            }
        }
    </script>
</body>